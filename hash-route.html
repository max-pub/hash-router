
<dom-module id="hash-route">
    <template>
        <template is="dom-if" if="{{DOM}}" restamp='true'>
            <content></content>
        </template>
    </template>
</dom-module>

<script>
    Polymer({
        is: "hash-route",
        properties: {
            regex: {
                type: String,
                observer: 'urlChange'
            },
            mode: {
                type:String,
                value: 'css'
            },
            p1:{ notify: true },
            p2:{ notify: true },
            p3:{ notify: true },
            p4:{ notify: true },
            p5:{ notify: true },
        },

        ready: function () {
            this.DOM = true;
            this.hide();
            window.addEventListener('hashchange',this.match.bind(this));
            this.match(); // is there another way??
        },
        show: function(){
            if(this.mode.toLowerCase()=='dom') this.DOM = true;
            this.hidden = false;
            // console.log("HASH",this.regex,this.DOM);
        },
        hide: function(){
            if(this.mode.toLowerCase()=='dom') this.DOM = false;
            this.hidden = true;
            // console.log("HASH",this.regex,this.DOM);
        },
        urlChange: function(event){
            this.match();
        },
        match: function(){
            var hash = document.location.hash;
            if(hash[0]==='#') hash = hash.substr(1);
            if(hash[0]==='!') hash = hash.substr(1);
            var regex = new RegExp('^'+this.regex+'$');
            var match = hash.match(regex);
            if(match) {
                this.set('p1',match[1]);
                this.set('p2',match[2]);
                this.set('p3',match[3]);
                this.set('p4',match[4]);
                this.set('p5',match[5]);
            }
            if(match) this.show();
            else this.hide();
            // this.hidden = match ? false : true;
            if(match) console.log('HASH-ROUTE match:', hash, regex);
        }
    });
</script>
